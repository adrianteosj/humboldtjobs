{% extends "static/base.html" %}

{% block title %}{{ page_title }} - Humboldt Jobs{% endblock %}

{% block content %}
<div class="container">
    <div class="layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            {% if last_updated %}
            <div class="last-updated">
                <span class="update-icon">üîÑ</span>
                <span>Last updated: {{ last_updated.strftime('%b %d, %Y at %I:%M %p') }}</span>
            </div>
            {% endif %}
            
            <div class="filter-section">
                <h3>Categories</h3>
                <ul class="filter-list">
                    <li>
                        <a href="/" class="{% if not selected_category and not selected_location and not selected_employer %}active{% endif %}">
                            All Jobs
                            <span class="filter-count">{{ total_all_jobs }}</span>
                        </a>
                    </li>
                    {% for cat, count in categories %}
                    <li>
                        <a href="/category/{{ cat | slugify }}/" class="{% if selected_category == cat %}active{% endif %}">
                            {{ cat }}
                            <span class="filter-count">{{ count }}</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <div class="filter-section">
                <h3>Locations</h3>
                <ul class="filter-list">
                    <li>
                        <a href="/" class="{% if not selected_location and not selected_category and not selected_employer %}active{% endif %}">
                            All Locations
                            <span class="filter-count">{{ total_all_jobs }}</span>
                        </a>
                    </li>
                    {% for loc, count in locations[:10] %}
                    <li>
                        <a href="/location/{{ loc | slugify }}/" class="{% if selected_location == loc %}active{% endif %}">
                            {{ loc[:20] }}{% if loc|length > 20 %}...{% endif %}
                            <span class="filter-count">{{ count }}</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <div class="filter-section">
                <h3>Top Employers</h3>
                <ul class="filter-list">
                    {% for emp in employers[:10] %}
                    <li>
                        <a href="/employer/{{ emp.name | slugify }}/" class="{% if selected_employer == emp.name %}active{% endif %}">
                            {{ emp.name[:25] }}{% if emp.name|length > 25 %}...{% endif %}
                            <span class="filter-count">{{ emp.job_count }}</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </aside>

        <!-- Main Content -->
        <main>
            <div class="page-header">
                <h1>{{ page_title }}</h1>
                <p>{{ total }} open position{% if total != 1 %}s{% endif %} from local employers</p>
            </div>

            {% if jobs %}
            <div class="job-list">
                {% for job in jobs %}
                <article class="job-card">
                    <div class="job-card-header">
                        <h2 class="job-title">
                            <a href="{{ job.url }}" target="_blank" rel="noopener">{{ job.title }}</a>
                        </h2>
                        <span class="job-category">{{ job.category }}</span>
                    </div>
                    
                    <div class="job-meta">
                        <span>üè¢ {{ job.employer }}</span>
                        {% if job.location %}
                        <span>üìç {{ job.location }}</span>
                        {% endif %}
                        {% if job.job_type %}
                        <span>‚è∞ {{ job.job_type }}</span>
                        {% endif %}
                    </div>
                    
                    {% if job.salary_text %}
                    <div class="job-salary">
                        üí∞ {{ job.salary_text }}
                    </div>
                    {% endif %}
                    
                    {% if job.description %}
                    <p class="job-description">{{ job.description[:200] }}{% if job.description|length > 200 %}...{% endif %}</p>
                    {% endif %}
                    
                    <div class="job-footer">
                        <div class="job-footer-left">
                            <span class="job-date {% if job.posted_date or job.closing_date %}has-date{% endif %}">
                                {% if job.posted_date %}
                                    <span class="date-label">üìÖ Posted:</span> {{ job.posted_date.strftime('%b %d, %Y') }}
                                    {% if job.closing_date %}
                                        <span style="margin: 0 0.5rem;">‚Ä¢</span>
                                        <span class="date-label">Closes:</span> {{ job.closing_date.strftime('%b %d, %Y') }}
                                    {% endif %}
                                {% elif job.closing_date %}
                                    <span class="date-label">Closes:</span> {{ job.closing_date.strftime('%b %d, %Y') }}
                                {% else %}
                                    Recently added
                                {% endif %}
                            </span>
                            <span class="job-source">
                                via {{ job.source_name | replace('_', ' ') | replace('neogov ', '') | replace('workday ', '') | title }}
                            </span>
                        </div>
                        <a href="{{ job.url }}" target="_blank" rel="noopener" class="apply-btn">
                            View & Apply ‚Üí
                        </a>
                    </div>
                </article>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if pages > 1 %}
            <div class="pagination">
                {% if prev_url %}
                <a href="{{ prev_url }}">‚Üê Prev</a>
                {% else %}
                <span class="disabled">‚Üê Prev</span>
                {% endif %}
                
                {% for p in range(1, pages + 1) %}
                    {% if p == page %}
                    <span class="active">{{ p }}</span>
                    {% elif p <= 3 or p > pages - 2 or (p >= page - 1 and p <= page + 1) %}
                        {% if p == 1 %}
                        <a href="{{ base_path }}">{{ p }}</a>
                        {% else %}
                        <a href="{{ base_path }}page/{{ p }}/">{{ p }}</a>
                        {% endif %}
                    {% elif p == 4 and page > 4 %}
                    <span>...</span>
                    {% elif p == pages - 2 and page < pages - 3 %}
                    <span>...</span>
                    {% endif %}
                {% endfor %}
                
                {% if next_url %}
                <a href="{{ next_url }}">Next ‚Üí</a>
                {% else %}
                <span class="disabled">Next ‚Üí</span>
                {% endif %}
            </div>
            {% endif %}

            {% else %}
            <div class="empty-state">
                <h3>No jobs found</h3>
                <p>Try adjusting your filters</p>
                <a href="/" class="apply-btn" style="margin-top: 1rem; display: inline-flex;">View all jobs</a>
            </div>
            {% endif %}
        </main>
    </div>
</div>
{% endblock %}
