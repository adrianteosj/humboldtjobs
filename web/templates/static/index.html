{% extends "static/base.html" %}

{% block title %}{{ page_title }} - Humboldt Jobs{% endblock %}

{% block content %}
<div class="container">
    <div class="layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            {% if last_updated %}
            <div class="last-updated">
                <span class="update-icon">üîÑ</span>
                <span>Last updated: {{ last_updated.strftime('%b %d, %Y at %I:%M %p') }}</span>
            </div>
            {% endif %}
            
            <div class="filter-section">
                <h3>Categories</h3>
                <ul class="filter-list">
                    <li>
                        <a href="/" class="{% if not selected_category and not selected_location and not selected_employer %}active{% endif %}">
                            All Jobs
                            <span class="filter-count">{{ total_all_jobs }}</span>
                        </a>
                    </li>
                    {% for cat, count in categories %}
                    <li>
                        <a href="/category/{{ cat | slugify }}/" class="{% if selected_category == cat %}active{% endif %}">
                            {{ cat }}
                            <span class="filter-count">{{ count }}</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <div class="filter-section">
                <h3>Locations</h3>
                <ul class="filter-list">
                    <li>
                        <a href="/" class="{% if not selected_location and not selected_category and not selected_employer %}active{% endif %}">
                            All Locations
                            <span class="filter-count">{{ total_all_jobs }}</span>
                        </a>
                    </li>
                    {% for loc, count in locations[:10] %}
                    <li>
                        <a href="/location/{{ loc | slugify }}/" class="{% if selected_location == loc %}active{% endif %}">
                            {{ loc[:20] }}{% if loc|length > 20 %}...{% endif %}
                            <span class="filter-count">{{ count }}</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <div class="filter-section" id="employer-filter-section">
                <div class="employer-filter-header">
                    <h3>Employers</h3>
                    <div class="employer-filter-actions">
                        <button class="employer-filter-btn" id="employer-select-all" title="Show all">All</button>
                        <button class="employer-filter-btn" id="employer-select-none" title="Hide all">None</button>
                    </div>
                </div>
                <div class="employer-filter-list">
                    {% for emp in employers %}
                    <div class="employer-filter-item" data-employer="{{ emp.name | lower }}">
                        <input type="checkbox" 
                               class="employer-filter-checkbox" 
                               id="emp-{{ loop.index }}" 
                               data-employer="{{ emp.name | lower }}"
                               checked>
                        <label class="employer-filter-label" for="emp-{{ loop.index }}">
                            <span>{{ emp.name[:25] }}{% if emp.name|length > 25 %}...{% endif %}</span>
                            <span class="filter-count">{{ emp.job_count }}</span>
                        </label>
                    </div>
                    {% endfor %}
                </div>
                <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border-color);">
                    <a href="/employers/" style="font-size: 0.85rem; color: var(--text-muted); text-decoration: none;">View career pages ‚Üí</a>
                </div>
            </div>

            <div class="filter-section" id="wage-filter-section">
                <div class="wage-filter-header">
                    <h3>Wage Range</h3>
                    <button class="wage-filter-reset" id="wage-filter-reset" title="Reset">Reset</button>
                </div>
                <div class="wage-filter-list">
                    <div class="wage-filter-item">
                        <input type="checkbox" class="wage-filter-checkbox" id="wage-under20" data-min="0" data-max="20" checked>
                        <label class="wage-filter-label" for="wage-under20">
                            <span>Under $20/hr</span>
                        </label>
                    </div>
                    <div class="wage-filter-item">
                        <input type="checkbox" class="wage-filter-checkbox" id="wage-20-30" data-min="20" data-max="30" checked>
                        <label class="wage-filter-label" for="wage-20-30">
                            <span>$20 - $30/hr</span>
                        </label>
                    </div>
                    <div class="wage-filter-item">
                        <input type="checkbox" class="wage-filter-checkbox" id="wage-30-50" data-min="30" data-max="50" checked>
                        <label class="wage-filter-label" for="wage-30-50">
                            <span>$30 - $50/hr</span>
                        </label>
                    </div>
                    <div class="wage-filter-item">
                        <input type="checkbox" class="wage-filter-checkbox" id="wage-50plus" data-min="50" data-max="999" checked>
                        <label class="wage-filter-label" for="wage-50plus">
                            <span>$50+/hr</span>
                        </label>
                    </div>
                    <div class="wage-filter-item">
                        <input type="checkbox" class="wage-filter-checkbox" id="wage-undisclosed" data-undisclosed="true" checked>
                        <label class="wage-filter-label" for="wage-undisclosed">
                            <span>Undisclosed</span>
                        </label>
                    </div>
                </div>
                <p class="wage-filter-note">Annual salaries converted to hourly</p>
            </div>
        </aside>

        <!-- Main Content -->
        <main>
            <div class="page-header">
                <h1>{{ page_title }}</h1>
                <p>{{ total }} open position{% if total != 1 %}s{% endif %} from local employers</p>
            </div>

            <!-- Search Bar -->
            <div class="search-container">
                <div class="search-input-wrapper">
                    <span class="search-icon">üîç</span>
                    <input type="text" 
                           id="job-search" 
                           class="search-input" 
                           placeholder="Search jobs by title, employer, or location..."
                           autocomplete="off">
                    <button class="search-clear" id="search-clear" aria-label="Clear search">‚úï</button>
                </div>
                <div class="search-results-info" id="search-results-info"></div>
            </div>

            <!-- Sub-category Tabs (shown when viewing a category with classifications) -->
            {% if subcategories and subcategories | length > 0 %}
            <div class="subcategory-tabs" id="subcategory-tabs">
                <a href="{{ base_path }}" class="subcategory-tab {% if not selected_classification %}active{% endif %}">
                    All<span class="tab-count">{{ category_total }}</span>
                </a>
                {% for subcat, count in subcategories %}
                <a href="{{ base_path }}{{ subcat | slugify }}/" class="subcategory-tab {% if selected_classification == subcat %}active{% endif %}">
                    {{ subcat }}<span class="tab-count">{{ count }}</span>
                </a>
                {% endfor %}
            </div>
            {% endif %}

            <div class="no-search-results" id="no-search-results">
                <h3>No matching jobs found</h3>
                <p>Try different keywords or <a href="/" style="color: var(--accent-green);">browse all jobs</a></p>
            </div>

            {% if jobs %}
            <div class="job-list">
                {% for job in jobs %}
                <article class="job-card" data-job-id="{{ job.id }}" data-employer="{{ job.employer | lower }}" data-title="{{ job.title | lower }}" data-location="{{ (job.location or '') | lower }}" data-category="{{ job.category | lower }}" data-classification="{{ (job.classification or '') | lower }}">
                    <div class="job-card-header">
                        <h2 class="job-title">
                            <a href="{{ job.url }}" target="_blank" rel="noopener">{{ job.title }}</a>
                        </h2>
                        <span class="job-category">{{ job.category }}</span>
                    </div>
                    
                    <div class="job-meta">
                        <span>üè¢ {{ job.employer }}</span>
                        {% if job.location %}
                        <span>üìç {{ job.location }}</span>
                        {% endif %}
                        {% if job.job_type %}
                        <span>‚è∞ {{ job.job_type }}</span>
                        {% endif %}
                    </div>
                    
                    <div class="job-salary {% if not job.salary_text %}salary-undisclosed{% endif %}">
                        üí∞ {{ job.salary_text if job.salary_text else 'Undisclosed' }}
                    </div>
                    
                    {% if job.description %}
                    <p class="job-description">{{ job.description[:200] }}{% if job.description|length > 200 %}...{% endif %}</p>
                    {% endif %}
                    
                    <div class="job-footer">
                        <div class="job-footer-left">
                            <span class="job-date {% if job.posted_date or job.closing_date %}has-date{% endif %}">
                                {% if job.posted_date %}
                                    <span class="date-label">üìÖ Posted:</span> {{ job.posted_date.strftime('%b %d, %Y') }}
                                    {% if job.closing_date %}
                                        <span style="margin: 0 0.5rem;">‚Ä¢</span>
                                        <span class="date-label">Closes:</span> {{ job.closing_date.strftime('%b %d, %Y') }}
                                    {% endif %}
                                {% elif job.closing_date %}
                                    <span class="date-label">Closes:</span> {{ job.closing_date.strftime('%b %d, %Y') }}
                                {% else %}
                                    Recently added
                                {% endif %}
                            </span>
                            <span class="job-source">
                                via {{ job.source_name | replace('_', ' ') | replace('neogov ', '') | replace('workday ', '') | title }}
                            </span>
                        </div>
                        <a href="{{ job.url }}" target="_blank" rel="noopener" class="apply-btn">
                            View & Apply ‚Üí
                        </a>
                    </div>
                </article>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if pages > 1 %}
            <div class="pagination">
                {% if prev_url %}
                <a href="{{ prev_url }}">‚Üê Prev</a>
                {% else %}
                <span class="disabled">‚Üê Prev</span>
                {% endif %}
                
                {% for p in range(1, pages + 1) %}
                    {% if p == page %}
                    <span class="active">{{ p }}</span>
                    {% elif p <= 3 or p > pages - 2 or (p >= page - 1 and p <= page + 1) %}
                        {% if p == 1 %}
                        <a href="{{ base_path }}">{{ p }}</a>
                        {% else %}
                        <a href="{{ base_path }}page/{{ p }}/">{{ p }}</a>
                        {% endif %}
                    {% elif p == 4 and page > 4 %}
                    <span>...</span>
                    {% elif p == pages - 2 and page < pages - 3 %}
                    <span>...</span>
                    {% endif %}
                {% endfor %}
                
                {% if next_url %}
                <a href="{{ next_url }}">Next ‚Üí</a>
                {% else %}
                <span class="disabled">Next ‚Üí</span>
                {% endif %}
            </div>
            {% endif %}

            {% else %}
            <div class="empty-state">
                <h3>No jobs found</h3>
                <p>Try adjusting your filters</p>
                <a href="/" class="apply-btn" style="margin-top: 1rem; display: inline-flex;">View all jobs</a>
            </div>
            {% endif %}
        </main>
    </div>
</div>
{% endblock %}
